# 这是一个年轻的膜法师写出的生命游戏

[TOC]

## 引言
生命游戏是一个无需人为操作的游戏，只需要开始将点标注在地图上，之后就再无需管理的一个游戏。因为其逻辑的简单，所以我将其使用js进行了实现，只不过本人技术不精，写不出优秀的代码，而且对js的理解也不够深入，优化也就无从谈起。只能再之后的努力学习中慢慢的进行改进。
## 生命游戏的逻辑
1. 如果一个细胞周围有两个以下的细胞，则该细胞为死
2. 如果一个细胞周围有两个细胞，该细胞的状态保持不变
3. 如果一个细胞周围有三个细胞，该细胞的状态为生
4. 如果一个细胞周围有三个以上的细胞，则该细胞为死

生命游戏的魅力就在于简单的逻辑可以构成复杂的图形。

## TODO
- [x] 细胞的添加/删除
- [x] 运行
- [x] 放大/缩小功能
- [ ] 放大/缩小优化
- [ ] 画线功能
- [ ] 地图拖拽功能
- [ ] 变速功能
- [ ] 性能优化

> 值得一提的是，我曾经尝试通过将遍历过的点暂存后以减少重复的访问来提高整体的运行速度，可是我却错了，这样似乎会造成内存的频繁读取和写入，而严重拖慢CPU的速度，遂将其废除。还是遍历所有的点来进行计算

## 算法及实现细节
* 使用canvas作为画布进行绘制
* 没有使用数组存取像素点而是采用计算某个像素点周围存在的像素点个数
* 方块的节点通过节点的“节点x坐标_节点y坐标”为键的map存储，以实现快速查询来增加当前节点周围的细胞数。
* 通过if-else查出需要设为生/死的细胞，存入暂存数组（set？）中，待本回合结束后从方块节点map中移除/添加

> 为何不在查找时移除/添加？因为在查找时移除会造成当前回合map状态的改变，对之后节点周围的细胞计算产生影响。所以只能选择暂存并在回合结束后删除。
## 有关放大缩小算法的实现
现阶段是通过以整数形式修改点的坐标，有一定的局限，因为前期的坐标是通过求模方法来实现的，如果是小数就会导致出现bug。只能等日后进行修改。
## 有关画线算法的实现
由于一些onmousemove的问题，event.ClientX 与 event.ClientY 在鼠标快速移动时不可能是连续的，所以想到了将获取的坐标进行暂存，然后计算两点连线经过方格坐标，添加进map中。由于一些不可描述的问题（本人智商不足，需要充值）进行了一天的研究想出了一个办法

计算x轴与y轴的步长差值，一旦超过步长，进行计算以及更新两端点的坐标

想法出现了些许的实现方面的问题，比如说方向怎么算，需要再进行考虑和分析。

又想到了一个骚套路，由于画线必然是连续的所以只需遍历查找到的点周围的8个点有哪个落在线上，将其加入Cubes数组即可 （务必于2017/7/6日之前实现）

计算直线方程。(y-y1)/(y2-y1) = (x-x1)/(x2-x1)
---
一个问题导致移动速度过慢开头坐标点没有添加上（重大BUG）详细情况可以打开试试，连接两点并遍历完成了
一次更新修复了小部分开头和慢速填不上的问题，但是仍然有断点bug。只不过没有之前版本严重。并产生了更多的BUG。。。
---
## 暂时想到的优化方案

> 由于是拍脑门想出来的优化方案，所以可能会优化的更加的慢。。。多踩几个坑肯定能总结出一套优化方案的。有想法应及时追加，即使不够靠谱。

- 是否可以将待添加的节点通过多线程加入堆中以保障存储速度不会限制计算速度？
- 是否可以通过一次性计算多步而减少遍历次数？
---
有网友提到了使用for loop卡顿几乎是必然的，可以先考虑如何在js里实现快速的2d卷积，有可能的话可以用FFT加速一下